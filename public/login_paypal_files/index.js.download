!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).AtomicEventsDom={})}(this,(function(t){"use strict";var e={};function n(t,e){if(!t||!("closest"in t))return;const n=t.closest(e);return n&&"dataset"in n?n:void 0}!function(t){const e={interactions:["CAPTCHA_SOLVED","FIRST_PAGE_LOAD","EXTERNAL_TO_PP"],viewNames:["CAPTCHA_MODAL"],tasks:["SOLVE_CAPTCHA"]},n=["AE_LIB","credit","identity_authnodeweb","identity_IWC","identity_UL","xo","xo_billing","xo_legacy_billing","xo_legacy_guest","xo_legacy_inline_guest","xo_legacy_onetime","xo_onetime","sdk_paypal_v5","sdk_paypal_v6","sdk_braintree_v3"];var i,a,o,r;t.LibraryActions=void 0,(i=t.LibraryActions||(t.LibraryActions={})).UI_STATE_CHANGED="UI_STATE_CHANGED",i.INIT="__INIT__",i.RESUME="__RESUME__",i.CI_STARTED="CI_STARTED",i.CI_ENDED="CI_ENDED",i.VALIDATION_FAILED="VALIDATION_FAILED",t.SystemActions=void 0,(a=t.SystemActions||(t.SystemActions={})).UI_READY_MARKED="UI_READY_MARKED",a.PROBLEM_MARKED="PROBLEM_MARKED",a.FLOW_EXITED="FLOW_EXITED",a.EVENT_MARKED="EVENT_MARKED",t.UserActions=void 0,(o=t.UserActions||(t.UserActions={})).ACTION_MISSING="ACTION_MISSING",o.BUTTON_WAIT_CLICKED="BUTTON_WAIT_CLICKED",o.INPUT_CLICKED="INPUT_CLICKED",o.BUTTON_CLICKED="BUTTON_CLICKED",o.FIRST_PAGE_LOAD="FIRST_PAGE_LOAD",function(t){t.POSSIBLE_MARKUIREADY_MISSING="POSSIBLE_MARKUIREADY_MISSING_VIOLATION"}(r||(r={}));const s={Ok:"Ok",Cancel:"Cancel",Error:"Error",FCI:"FCI"};var c;!function(t){t.SUCCESS="0",t.FATAL="1",t.ERROR="2",t.EXCEPTION="3",t.WARNING="4"}(c||(c={}));const u=new class{constructor(){this._subscribers=[]}subscribe(t){this._subscribers.push(t)}publish(t){this._subscribers.forEach((e=>e(t)))}};var l;!function(t){t.MISSING="missing",t.SESSIONSTORAGE_STATE_KEY="__atomic-event-state",t.SESSIONSTORAGE_STATE_HISTORY_KEY="__atomic-event-state-history",t.SESSIONSTORAGE_EVENTSTREAM_KEY="__atomic-event-stream",t.STATE_QUERY_KEY="atomic-event-state"}(l||(l={}));const m="obs::atomics::",d=[],_=[],v=(t,e,n)=>{d.length<1||_.length>0?_.push([t,e,n]):f(t,e,n)},f=(t,e,n)=>{d.forEach((i=>{if("function"==typeof i)try{i(t,e,n)}catch(t){}}))};function E(t){d.push(t),_.length>0&&setTimeout((()=>{_.forEach((([t,e,n])=>{f(t,e,n)})),_.splice(0)}),0)}var I,S;function p(){var t,e,n;if("undefined"==typeof window)return"unknown";const i=null===(n=null===(e=null===(t=window.performance)||void 0===t?void 0:t.getEntriesByType)||void 0===e?void 0:e.call(t,"navigation"))||void 0===n?void 0:n[0];return(null==i?void 0:i.type)||"unknown"}function w(t,e){return{actor:I.System,type:t,ts:performance.now(),navType:p(),data:Object.assign({},e)}}function N(t,e){return{actor:I.User,type:t,ts:performance.now(),navType:p(),data:Object.assign({},e)}}function y(e){return{actor:I.Library,type:t.LibraryActions.VALIDATION_FAILED,ts:performance.now(),data:e}}!function(t){t.Library="library",t.System="system",t.User="user"}(I||(I={})),function(t){t.READY="ready",t.WAITING="waiting"}(S||(S={}));const T={uiState:S.WAITING,domain:l.MISSING,events:[],intent:"",intentType:l.MISSING,task:l.MISSING,flow:l.MISSING,path:"/",timeStamp:0,timeOrigin:performance.timeOrigin,interactionStartTime:0,viewName:l.MISSING},A=[];function O(){return A[A.length-1]}const g=O,h=[];function R(t){for(const e of t)"function"==typeof e&&h.push(e)}function C(e){const n=O(),i=function(e=T,n){var i,a;if(n.type===t.LibraryActions.RESUME||n.type===t.LibraryActions.INIT){const t=null!==(i=n.data.savedState)&&void 0!==i?i:{},{intent:o,intentType:r,interactionStartTime:s,domain:c,task:u,flow:l,viewName:m}=n.data;return Object.assign(Object.assign(Object.assign({},e),t),{intent:o,intentType:r,interactionStartTime:s,domain:c,task:u,flow:l,viewName:m,isResumed:n.data.isResumed,path:L(null!==(a=window.location.pathname)&&void 0!==a?a:"")})}switch(null==e?void 0:e.uiState){case S.READY:return function(e,n){var i;if(n.type===t.UserActions.BUTTON_WAIT_CLICKED){const{intent:t,intentType:a,task:o,flow:r}=n.data;return{domain:n.data.domain||e.domain,events:[],intent:t,intentType:null!=a?a:l.MISSING,interactionStartTime:performance.now(),timeStamp:Math.round(performance.now()),timeOrigin:performance.timeOrigin,task:o||e.task||l.MISSING,flow:r||e.flow||l.MISSING,uiState:S.WAITING,path:L(null!==(i=window.location.pathname)&&void 0!==i?i:""),viewName:n.data.viewName||e.viewName||l.MISSING}}return e}(e,n);case S.WAITING:return function(e,n){var i;switch(n.type){case t.SystemActions.UI_READY_MARKED:{const{domain:t,status:a,viewName:o,task:r}=n.data,s=e.timeOrigin+e.interactionStartTime,c=performance.timeOrigin+performance.now()-s,u=function(t){const e={reason:null,status:null,domain:null,errorContext:null},n=t.events.filter((t=>"problem"===t.type));if(n.length<1)return e;const i=function(t){const e=["Ok","Cancel","Error","FCI"];let n=t[0];return t.forEach((t=>{t.data.status&&n.data.status&&e.indexOf(t.data.status)>e.indexOf(n.data.status)&&(n=t)})),n}(n);return i?{reason:i.data.reason,status:i.data.status,domain:i.data.domain,errorContext:i.data.errorContext}:e}(e),m=Math.round(c);return{domain:t||e.domain,timeStamp:Math.round(performance.now()),timeOrigin:performance.timeOrigin,duration:m,path:L(null!==(i=window.location.pathname)&&void 0!==i?i:""),status:u.status||a,viewName:o||l.MISSING,uiState:S.READY,task:r||e.task||l.MISSING,flow:e.flow||l.MISSING,events:[]}}case t.SystemActions.EVENT_MARKED:{const{eventName:i,appendEndCiNameWith:a,attributeEndCiWith:o}=n.data,r={eventName:t.SystemActions.EVENT_MARKED,type:"manual",timestamp:performance.now(),data:{eventName:i,appendEndCiNameWith:a,attributeEndCiWith:o}};return Object.assign(Object.assign({},e),{events:[...e.events,r]})}case t.SystemActions.PROBLEM_MARKED:{const i=n.data,{domain:a,status:o,reason:r,errorContext:s}=i,c={eventName:t.SystemActions.PROBLEM_MARKED,type:"problem",timestamp:performance.now(),data:{status:o,domain:a,reason:r,errorContext:s}};return Object.assign(Object.assign({},e),{events:[...e.events,c]})}}return e}(e,n);default:return e}}(n,e);!function(t){A.push(t)}(i),function(t){for(const e of h)"function"==typeof e&&e(t)}({previousState:n,newState:i,action:e,stateHistory:A}),v(e,i,A)}const b=/^(?=.*[A-Za-z])(?=.*\d)/g,L=t=>t.split("/").map((t=>b.test(t)?"[id]":t)).join("/");function D({domain:e,flow:n,viewName:i,task:a,interactionStartTime:o}){var r;C(function({domain:e,flow:n,task:i,viewName:a,interactionStartTime:o=0},{referrerHost:r,currentHost:s}={}){let c="FIRST_PAGE_LOAD";return r&&r!=s&&(c="EXTERNAL_TO_PP"),{type:t.LibraryActions.INIT,actor:I.Library,ts:0,navType:p(),data:{intent:c,intentType:"render",domain:e,interactionStartTime:o,task:i||l.MISSING,flow:n,viewName:a||l.MISSING}}}({domain:e,flow:n,viewName:i,task:a,interactionStartTime:o},{referrerHost:document.referrer&&(null===(r=new URL(document.referrer))||void 0===r?void 0:r.host),currentHost:location.host}))}function M(...t){C(y(...t))}function k(t){const{level:e,action:n,eventName:i}=t;let a=null;"error"===t.level&&(a=t.error instanceof Error?t.error:new Error("Unknown Error"));const o=g(),r=o?JSON.stringify(o):"no_state",s={type:"log",value:{eventType:"ATOMICS",eventName:i,status:W(e),payload:Object.assign(Object.assign(Object.assign({},n?{action:JSON.stringify(n)}:void 0),a?{error:JSON.stringify(a,Object.getOwnPropertyNames(a))}:void 0),{timeStamp:performance.now(),timeOrigin:performance.timeOrigin,currentState:r})}};u.publish([s])}function U({action:t,eventName:e}){return k({action:t,eventName:e,level:"warn"})}function G({action:t,eventName:e,error:n}){return k({action:t,eventName:e,level:"error",error:n})}function W(t){switch(t){case"info":default:return c.SUCCESS;case"warn":return c.WARNING;case"error":return c.ERROR}}function P(t){const e=(new TextEncoder).encode(t),n=Array.from(e,(t=>String.fromCodePoint(t))).join("");return btoa(n)}function K(){let t;try{"undefined"!=typeof window&&(t=window.__ATOMIC_EVENTS_DEV_LOGGER__||window.parent.__ATOMIC_EVENTS_DEV_LOGGER__)}catch(t){G({eventName:"atomics_error_getting_devlogger_extension",error:t})}return t}function V(t){try{const e=g();return e&&"ready"!==e.uiState?(null==t?void 0:t.encoded)?{searchParameter:l.STATE_QUERY_KEY,encodedState:P(JSON.stringify(e))}:e:null}catch(t){const{message:e,name:n}=t instanceof Error?t:{},i="atomics_core_error_caught",a=`${n}:${e}`;return G({eventName:i,error:t}),M({value:a,name:i}),null}}var j,Y;!function(t){t.COUNTER="counter",t.HISTOGRAM="histogram"}(j||(j={})),function(t){t.FLOW_END="flow_end",t.UI_WAIT_END="ui_wait_end",t.UI_WAIT_START="ui_wait_start",t.USER_WAIT_TIME="user_wait_time",t.DURATION_VIOLATION="duration_violation",t.USER_WAIT_TIME_EXPONENTIAL="user_wait_time_exponential",t.VALIDATION_FAILED="validation_failed",t.POSSIBLE_VIOLATION="possible_violation"}(Y||(Y={}));const x="0.16.0",F="pp.xo.ui.ci",H=`${F}.timing.exponential`,B=`${F}.count`;function $({previousState:e,newState:n,action:i}){return i.type===t.SystemActions.FLOW_EXITED?function({newState:t,action:e}){var n;const{domain:i,flow:a}=t,{viewName:o,status:r,task:s}=e.data;return[{type:"metric",value:{dimensions:{domain:i,status:r,view_name:null!=o?o:l.MISSING,task:null!=s?s:l.MISSING,flow:a,nav_type:e.navType,path:L(null!==(n=X())&&void 0!==n?n:""),atomic_lib_version:x},metricEventName:Y.FLOW_END,metricId:"pp.xo.flow.count",metricType:j.COUNTER}}]}({newState:n,action:i}):i.type===t.LibraryActions.INIT&&n.uiState===S.WAITING||i.type===t.UserActions.BUTTON_WAIT_CLICKED&&(null==e?void 0:e.uiState)===S.READY&&n.uiState===S.WAITING?function({newState:t,action:e}){var n;const{domain:i,flow:a}=t,{intent:o,intentType:r,task:s}=e.data;return[{type:"metric",value:{dimensions:{domain:i,interaction:null!=o?o:l.MISSING,interaction_type:null!=r?r:l.MISSING,nav_type:e.navType,task:null!=s?s:l.MISSING,flow:a,path:L(null!==(n=X())&&void 0!==n?n:""),atomic_lib_version:x},metricEventName:Y.UI_WAIT_START,metricId:B,metricType:j.COUNTER}}]}({newState:n,action:i}):i.type===t.SystemActions.UI_READY_MARKED&&(null==e?void 0:e.uiState)===S.WAITING&&n.uiState===S.READY?function({previousState:t,newState:e,action:n}){var i;const a=t.domain!==l.MISSING&&e.domain!==t.domain?"true":"false",o=function(t){const e=t.find((t=>"manual"===t.type&&(t.data.attributeEndCiWith||t.data.appendEndCiNameWith)));if("manual"===(null==e?void 0:e.type))return e.data.attributeEndCiWith||e.data.appendEndCiNameWith}(t.events),r=Object.assign({domain:e.domain,start_domain:t.domain,was_resumed:Boolean(t.isResumed)?"true":"false",is_cross_app:a,interaction:t.intent||l.MISSING,status:e.status,nav_type:n.navType,task:e.task||l.MISSING,flow:e.flow,view_name:e.viewName,atomic_lib_version:x,start_view_name:t.viewName||l.MISSING,start_task:t.task||l.MISSING,start_path:t.path,path:L(null!==(i=X())&&void 0!==i?i:"")},o?{eventAttribute:o}:{}),s=[{type:"metric",value:{dimensions:r,metricEventName:Y.USER_WAIT_TIME_EXPONENTIAL,metricId:H,metricType:j.HISTOGRAM,metricValue:e.duration}},{type:"metric",value:{dimensions:Object.assign(Object.assign({},r),{interaction_type:t.intentType||l.MISSING}),metricEventName:Y.UI_WAIT_END,metricId:B,metricType:j.COUNTER}}];if(e.duration>3e4){const t={dimensions:r,metricEventName:Y.DURATION_VIOLATION,metricId:H,metricType:j.HISTOGRAM,metricValue:e.duration},i=`${m}Your metrics duration exceeds 30s: ${e.duration}.`;G({action:n,eventName:"atomics_duration_violation",error:new Error(i)}),s.push({type:"metric",value:t})}return s}({previousState:e,newState:n,action:i}):i.type===t.LibraryActions.VALIDATION_FAILED?function({newState:t,action:e}){var n;const{domain:i,viewName:a,task:o,flow:r}=t,{name:s}=e.data;return[{type:"metric",value:{dimensions:{domain:i,status:"Ok",view_name:null!=a?a:l.MISSING,task:o||l.MISSING,flow:r,path:L(null!==(n=X())&&void 0!==n?n:""),atomic_lib_version:x,property_name:s},metricEventName:Y.VALIDATION_FAILED,metricId:B,metricType:j.COUNTER}}]}({newState:n,action:i}):i.type===r.POSSIBLE_MARKUIREADY_MISSING?function({newState:t,action:e}){var n;const{domain:i,viewName:a,task:o,flow:r}=t,{name:s,value:c}=e.data;return[{type:"metric",value:{dimensions:{domain:i,status:"Ok",view_name:null!=a?a:l.MISSING,task:o||l.MISSING,flow:r,path:L(null!==(n=X())&&void 0!==n?n:""),atomic_lib_version:x,property_value:String(c),property_name:s},metricEventName:Y.POSSIBLE_VIOLATION,metricId:B,metricType:j.COUNTER}}]}({newState:n,action:i}):[]}const X=()=>{if("undefined"!=typeof window)return window.location.pathname};function J({previousState:t,newState:e,action:n}){if(!e||!n)return;const i=$({previousState:t,newState:e,action:n});i.length&&u.publish(i)}let z=0;const Z=()=>{let t,e;const n=new Promise(((n,i)=>{t=n,e=i}));return{count:z++,reject:e,resolve:t,value:n}};class Q{constructor(t){this.loggerEndpoint=t,this.subscription=t=>{this.batchClientEmitter.emit(t)},this.createBatcher=()=>{let t,e,n,i=Z(),a=[];return{emit:o=>function(t,e,n,i){return new(n||(n=Promise))((function(e,a){function o(t){try{s(i.next(t))}catch(t){a(t)}}function r(t){try{s(i.throw(t))}catch(t){a(t)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,r)}s((i=i.apply(t,[])).next())}))}(this,0,void 0,(function*(){return t||(t=Date.now()),e=Date.now(),a.push(...o),n&&clearTimeout(n),n=setTimeout((()=>{const o=i,r=this.emitFetch(a);i=Z(),e=void 0,a=[],n=void 0,t=void 0,r.then((t=>{o.resolve(t)})).catch((t=>{o.reject(t)}))}),100-(e-t)),i.value}))}},this.batchClientEmitter=this.createBatcher()}emitFetch(t){const e=new Headers({"Content-Type":"application/json"});return fetch(this.loggerEndpoint,{body:JSON.stringify(t),headers:e,method:"POST"})}}let q=!1;function tt(e){null===e||"string"!=typeof e.intent||"string"!=typeof e.domain||e.task&&"string"!=typeof e.task||e.viewName&&"string"!=typeof e.viewName||e.flow&&"string"!=typeof e.flow?M({value:e,name:"savedState"}):(q=!0,C(function(e){const{intent:n,intentType:i,task:a,domain:o,viewName:r,flow:s}=e;return{type:t.LibraryActions.RESUME,actor:I.Library,ts:performance.now(),navType:p(),data:{intent:n,intentType:i,interactionStartTime:e.timeStamp,task:a,flow:s,domain:o,viewName:null!=r?r:"",savedState:e,isResumed:!0}}}(e)))}function et(e,n){C(function(e,n){return{type:t.SystemActions.EVENT_MARKED,ts:performance.now(),data:Object.assign({eventName:e},n)}}(e,{appendEndCiNameWith:null==n?void 0:n.appendEndCiName,attributeEndCiWith:null==n?void 0:n.attributeEndCiWith}))}function nt(t,e,n){return!(e&&!n.includes(e)&&(C(y({value:e,name:t})),G({eventName:"atomics_core_error_validating_attribute",error:new Error(`${m}Invalid value detected for ${t}: "${e}"\nValue must be one of ${JSON.stringify(n,null,2)}`)}),1))}function it(t){return(...e)=>{try{return t(...e)}catch(t){const{message:e,name:n}=t instanceof Error?t:{},i="atomics_core_error_caught",a=`${n}:${e}`;return G({eventName:i,error:t}),void M({value:a,name:i})}}}t.__emitError=G,t.__emitInfo=function({action:t,eventName:e}){return k({action:t,eventName:e,level:"info"})},t.__emitWarn=U,t.__fireCreateUserAction=function(...t){C(N(...t))},t.__fireMarkUIReadyViolationAction=function(...t){C(function(t){return{actor:I.Library,type:r.POSSIBLE_MARKUIREADY_MISSING,ts:performance.now(),data:t}}(...t))},t.__fireValidationFailedAction=M,t.addListener=E,t.atomicDomains=n,t.createAtomics=function(i,a=(()=>{})){var o;const{initialState:r,policy:c}=i,{domain:m,flow:d,task:_,viewName:v}=null!=r?r:{},{viewNames:f,interactions:I,tasks:S,flows:p}=null!=c?c:{},{actionMiddlewares:y=[],options:T}=i,A=null===(o=null==T?void 0:T.autoInit)||void 0===o||o;if("function"!=typeof a)throw new Error(`'metricEventsSubscriber' must be a function. ${typeof a} was given.`);if(!(m&&f&&I&&S))throw new Error("Your application does not configure atomics library correctly. See https://github.paypal.com/Checkout/atomic-events#readme for the latest API.");if(nt("flow",d,p)||M({value:d,name:"flow"}),null==T?void 0:T.loggerEndpoint){const t=new Q(T.loggerEndpoint);u.subscribe(t.subscription)}u.subscribe(a);const O=m,g=[...e.viewNames,...f],h=[...e.interactions,...I],b=[...e.tasks,...S];function L({viewName:t,interaction:e,status:i,domain:a,task:o,flow:r}){nt("viewName",t,g),nt("domain",a,n),nt("interaction",e,h),nt("status",i,Object.values(s)),nt("task",o,b),nt("flow",r,p)}function k(e,n,i){var a;const{task:o=""}=i,r=null!==(a=i.domain)&&void 0!==a?a:O;L({viewName:e,interaction:null,status:n,domain:r,task:o,flow:null}),C(w(t.SystemActions.UI_READY_MARKED,function(t,e,n){return Object.assign({viewName:t,status:e},n)}(e,n,{domain:r,task:o})))}function W(t){q?U({eventName:"atomics_core_library_already_initialized_warning"}):(D({domain:m,flow:null!=d?d:l.MISSING,task:null!=_?_:l.MISSING,viewName:null!=v?v:l.MISSING,interactionStartTime:t}),q=!0)}R([J]),y.length&&R(y);try{const t=K();t&&E(t())}catch(t){G({eventName:"atomics_error_adding_devlogger_extension",error:t})}!function(){try{const t=K();t&&E(t())}catch(t){G({eventName:"atomics_error_adding_devlogger_extension",error:t})}}();try{A&&W()}catch(t){const{message:e,name:n}=t instanceof Error?t:{},i="atomics_error_initializing_library",a=`${n}:${e}`;G({eventName:i,error:t}),M({value:a,name:i})}return{markProblem:it((function(e){const{status:n,context:i,domain:a,reason:o}=e;L({viewName:null,interaction:null,status:e.status,domain:null!=a?a:null,task:null,flow:null}),C(w(t.SystemActions.PROBLEM_MARKED,function(t,e){return Object.assign({status:t},e)}(n,{errorContext:i,domain:a||O,reason:o})))})),markUIReady:it(k),leaveFlow:it((function(e,n,i){var a;const{task:o=""}=i,r=null!==(a=i.domain)&&void 0!==a?a:O;k(e,n,i),C(w(t.SystemActions.FLOW_EXITED,function(t,e,n){return Object.assign({viewName:t,status:e},n)}(e,n,{domain:r,task:o})))})),__markUIWaiting:it((function(e,n,i){var a;L({viewName:n,interaction:e,status:null,domain:null,task:i.task,flow:null!==(a=i.flow)&&void 0!==a?a:null}),C(N(t.UserActions.BUTTON_WAIT_CLICKED,function(t,e,n){return Object.assign({intent:t,viewName:e},n)}(e,n,Object.assign(Object.assign({},i),{domain:i.domain||m}))))})),init:it(W),resume:it(tt),getWaitingState:V,markEvent:it(et)}},t.libraryPolicy=e,t.removeListener=function(t){const e=d.indexOf(t);d.splice(e,1)}}(e);var i=function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function r(t){try{c(i.next(t))}catch(t){o(t)}}function s(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,s)}c((i=i.apply(t,e||[])).next())}))};function a(t){window.addEventListener("locationchange",(function(){t({eventName:"listeners.location.change",type:"locationChange",payload:{location:window.location.href}})})),window.addEventListener("popstate",(()=>{window.dispatchEvent(new Event("locationchange"))})),function(t){o||(o={pushState:t.history.pushState,replaceState:t.history.replaceState});t.history.pushState=new Proxy(o.pushState,{apply(e,n,a){return i(this,arguments,void 0,(function*(e,n,[i,a,o]){return t.dispatchEvent(new Event("locationchange")),Reflect.apply(e,n,[i,a,o])}))}}),t.history.replaceState=new Proxy(o.replaceState,{apply(e,n,a){return i(this,arguments,void 0,(function*(e,n,[i,a,o]){return t.dispatchEvent(new Event("locationchange")),Reflect.apply(e,n,[i,a,o])}))}})}(window)}let o;var r;function s(t,e={}){var n,i,a,o,r;return t?{interaction:null!==(n=c(t,"interaction"))&&void 0!==n?n:e.interaction,flow:null!==(i=c(t,"flow"))&&void 0!==i?i:e.flow,task:null!==(a=c(t,"task"))&&void 0!==a?a:e.task,domain:null!==(o=c(t,"domain"))&&void 0!==o?o:e.domain,viewName:null!==(r=c(t,"viewName"))&&void 0!==r?r:e.viewName}:{}}function c(t,e){var n;const i=t.closest(function(t){return`[data-atomic-wait-${u[t]||t}]`}(e));return null===(n=null==i?void 0:i.dataset)||void 0===n?void 0:n[function(t){var e;const n=(null!==(e=u[t])&&void 0!==e?e:t).toLowerCase();return`atomicWait${n.charAt(0).toUpperCase()+n.slice(1)}`}(e)]}!function(t){t.MISSING="missing",t.SESSIONSTORAGE_STATE_KEY="__atomic-event-state",t.SESSIONSTORAGE_STATE_HISTORY_KEY="__atomic-event-state-history",t.SESSIONSTORAGE_EVENTSTREAM_KEY="__atomic-event-stream",t.STATE_QUERY_KEY="atomic-event-state"}(r||(r={}));const u={interaction:"intent"};var l;let m;!function(t){t.READY="ready",t.WAITING="waiting"}(l||(l={}));try{m=window.sessionStorage}catch(t){m=void 0}function d(t,e,n){m&&(n&&Array.isArray(e)&&(e=e.slice(e.length-n)),m.setItem(t,JSON.stringify(e)))}function _({newState:t,stateHistory:e}){t&&d(r.SESSIONSTORAGE_STATE_KEY,t),e&&d(r.SESSIONSTORAGE_STATE_HISTORY_KEY,e)}function v(){if(!m)return;let t=null;try{const n=function(t){if(!m)return;try{return m.getItem(t)}catch(t){const n=t instanceof Error?t:new Error("Unknown Error");e.__emitError({eventName:"atomics_error_reading_from_session_storage",error:n})}return}(r.SESSIONSTORAGE_STATE_KEY);if(!n)return;t=E(n)}catch(t){const n=t instanceof Error?t:new Error("Unknown Error");e.__emitError({eventName:"atomics_error_resuming_from_local_storage",error:n})}return m.removeItem(r.SESSIONSTORAGE_STATE_KEY),t}function f(){if("undefined"==typeof window)return null;const t=new URLSearchParams(window.location.search).get(r.STATE_QUERY_KEY);if(!t)return null;let n=null;try{n=E(function(t){const e=atob(t),n=Uint8Array.from(e,(t=>{var e;return null!==(e=t.codePointAt(0))&&void 0!==e?e:0}));return(new TextDecoder).decode(n)}(t))}catch(t){e.__emitError({eventName:"atomics_error_resuming_from_query_parameter",error:t})}return n}function E(t){const e=JSON.parse(t);if((null==e?void 0:e.uiState)!==l.WAITING)throw new Error("not a valid waiting state, discard");const n=e.timeOrigin+e.timeStamp;if(performance.timeOrigin+performance.now()-n>29e3)throw new Error("saved CI state is stale, discard");return e}function I(t){return"markUIWaiting"===t.type}var S;!function(t){t.DuplicateWaiting="duplicate_waiting_violation",t.MissingReady="missing_ready_violation"}(S||(S={}));const p=4e3;let w,N,y=!1;const T=[];function A({eventName:t,type:n,payload:i}){const a={name:t,type:null!=n?n:"manual"};i&&(a.payload=i),T.push(a),function(t){d(r.SESSIONSTORAGE_EVENTSTREAM_KEY,t,50)}(T),function(t,n){var i;y?(function(t){return"locationChange"===t.type}(t)||I(t)?(N&&clearTimeout(N),I(t)&&w&&I(w)&&null!==(i=t.payload.intent&&t.payload.intent!==w.payload.intent)&&void 0!==i&&i&&(n({eventName:S.DuplicateWaiting,type:"violation",payload:w.payload}),e.__fireMarkUIReadyViolationAction({value:S.DuplicateWaiting,name:"violation"})),N=setTimeout((()=>{n({eventName:S.MissingReady,type:"violation",payload:t.payload}),e.__fireMarkUIReadyViolationAction({value:S.MissingReady,name:"violation"})}),p)):function(t){return"markUIReady"===t.type}(t)&&N&&clearTimeout(N),function(t){return"markUIReady"===t.type||"markUIWaiting"===t.type}(t)&&(w=t)):function(t){return"windowLoad"===t.type}(t)&&(y=!0)}(a,A)}function O(t){return(...n)=>{try{return t(...n)}catch(t){const{message:n,name:i}=t instanceof Error?t:{},a="atomics_dom_error_caught",o=`${i}:${n}`;return e.__emitError({eventName:a,error:t}),void e.__fireValidationFailedAction({value:o,name:a})}}}t.SystemActions=e.SystemActions,t.addListener=e.addListener,t.atomicDomains=e.atomicDomains,t.createAtomics=function(t,i=(()=>{})){var o,r,c,u,l,m,d,E,I,S;let p,w=null===(r=null===(o=t.options)||void 0===o?void 0:o.autoInit)||void 0===r||r;p=void 0===(null===(c=t.options)||void 0===c?void 0:c.autoInit)?null===(l=null===(u=t.options)||void 0===u?void 0:u.autoResume)||void 0===l||l:!1!==(null===(m=t.options)||void 0===m?void 0:m.autoInit)&&(null===(E=null===(d=t.options)||void 0===d?void 0:d.autoResume)||void 0===E||E);const N=null!==(I=t.actionMiddlewares)&&void 0!==I?I:[],y=t.initialState.domain,T=e.createAtomics(Object.assign(Object.assign({},t),{actionMiddlewares:[...N,_],options:Object.assign(Object.assign({},t.options),{autoInit:!1})}),i);function g(t,e,n){A({eventName:"markUIWaiting",type:"markUIWaiting",payload:Object.assign(Object.assign({},n),{viewName:e,intent:t})}),T.__markUIWaiting(t,e,n)}function h(t,e,n){A({eventName:"markUIReady",type:"markUIReady",payload:Object.assign(Object.assign({},n),{viewName:t,status:e})}),T.markUIReady(t,e,n)}function R(){var t;!function(t){document.addEventListener("click",(function(i){var a,o,r,s,c;const u=n(i.target,"[data-atomic-wait-intent]");if(!u)return;const l=null!==(a=null==u?void 0:u.nodeName)&&void 0!==a?a:"",m={intent:null==u?void 0:u.dataset.atomicWaitIntent,viewName:null==u?void 0:u.dataset.atomicWaitViewname,task:null==u?void 0:u.dataset.atomicWaitTask,domain:null==u?void 0:u.dataset.atomicWaitDomain},d=n(i.target,"[data-atomic-wait-flow]");let _=e.UserActions.BUTTON_CLICKED;if(m.intent)return _=e.UserActions.BUTTON_WAIT_CLICKED,void t(m.intent,null!==(o=m.viewName)&&void 0!==o?o:"",{task:m.task,flow:null==d?void 0:d.dataset.atomicWaitFlow,domain:m.domain,intentType:"click"});"INPUT"===l?_=e.UserActions.INPUT_CLICKED:"BUTTON"===l&&(_=e.UserActions.BUTTON_CLICKED),e.__fireCreateUserAction(null!=_?_:"ACTION_MISSING",{task:null!==(r=m.task)&&void 0!==r?r:"None",flow:null==d?void 0:d.dataset.atomicWaitFlow,domain:m.domain,intent:null!==(s=m.intent)&&void 0!==s?s:"",intentType:"click",viewName:null!==(c=m.viewName)&&void 0!==c?c:""})}),{capture:!0,passive:!0})}(g),function(t,e){window.addEventListener("NGRL_CAPTCHA_EVENT",(function(n){switch(n.detail.state){case"CAPTCHA_MODAL_SHOWN":case"CAPTCHA_TRIGGERED":!function(t){t("CAPTCHA_MODAL","Error",{task:"SOLVE_CAPTCHA"})}(e);break;case"CAPTCHA_MODAL_HIDDEN":case"CAPTCHA_SOLVED":!function(t){t("CAPTCHA_SOLVED","CAPTCHA_MODAL",{task:"SOLVE_CAPTCHA",intentType:"submit"})}(t)}}))}(g,h),a(A),t=A,"complete"===(null===document||void 0===document?void 0:document.readyState)?t({eventName:"window.load",type:"windowLoad"}):window.addEventListener("load",(function(){t({eventName:"window.load",type:"windowLoad"})}))}function C(...t){"undefined"!=typeof window?window.__ATOMIC_EVENTS_INITIALIZED__?e.__emitWarn({eventName:"atomics_dom_library_already_initialized_warning"}):(A({eventName:"init",type:"init",payload:Object.assign({},t)}),R(),T.init(...t),window.__ATOMIC_EVENTS_INITIALIZED__=!0):e.__emitWarn({eventName:"atomics_dom_library_already_initialized_warning"})}function b(...t){window.__ATOMIC_EVENTS_INITIALIZED__||(R(),window.__ATOMIC_EVENTS_INITIALIZED__=!0),A({eventName:"resume",type:"resume",payload:Object.assign({},t)}),T.resume(...t)}if("undefined"!=typeof window)try{if(p){const t=null!==(S=v())&&void 0!==S?S:f();t&&(b(t),w=!1)}w&&C()}catch(t){const{message:n,name:i}=t instanceof Error?t:{},a="atomics_dom_error_initializing_library",o=`${i}:${n}`;e.__emitError({eventName:a,error:t}),e.__fireValidationFailedAction({value:o,name:a})}return{markProblem:T.markProblem,markUIReady:O(h),leaveFlow:T.leaveFlow,__markUIWaiting:O(g),init:O(C),resume:O(b),getWaitingState:T.getWaitingState,markEvent:O((function(t,e){A({eventName:t,payload:e}),T.markEvent(t,e)})),getAtomicContext:t=>O(s)(t,{domain:y})}},t.getAtomicContext=s,t.libraryPolicy=e.libraryPolicy,t.removeListener=e.removeListener}));
